<?xml version="1.0" encoding="utf-8"?>
<LoggingEngine filePrefix="UnifyLog" logDaysKeep="60" minimumLoggingLevel="Normal">
  <LogWriter xmlns="" name="LogWriterFilterDecorator" id="a9f893ba-bb8b-4c2f-9b9a-4b8007475611" enabled="true" displayName="UNIFY Support Email">
    <LogWriter name="LogWriterFilterDecorator">
      <LogWriter name="Email" fromAddress="svcFIM_Service@dbb.org.au" replyToAddress="robert.broadley@dbb.catholic.edu.au" senderAddress="svcFIM_Service@dbb.org.au" smtpHost="smtp.dbb.local" subjectPrefix="CSODBB MIM (PROD): " toAddress="csodbbsupport@unifysolutions.net,robert.broadley@dbb.catholic.edu.au" />
      <logFilter name="MinimumLoggingLevel" loggingLevel="Normal" />
    </LogWriter>
    <logFilter name="MinimumSeverityLevel" severity="Error" />
  </LogWriter>
  <LogWriter xmlns="" name="LogWriterFilterDecorator" id="72ca9da8-06ec-49d9-abab-c6c98d352483" enabled="false" displayName="Log Errors to UNIFY OMS">
    <LogWriter name="LogWriterFilterDecorator">
      <LogWriter name="PowerShell" beginScript="# Create the function to create the authorization signature&#xD;&#xA;Function Build-Signature ($customerId, $sharedKey, $date, $contentLength, $method, $contentType, $resource)&#xD;&#xA;{&#xD;&#xA;    $xHeaders = &quot;x-ms-date:&quot; + $date&#xD;&#xA;    $stringToHash = $method + &quot;`n&quot; + $contentLength + &quot;`n&quot; + $contentType + &quot;`n&quot; + $xHeaders + &quot;`n&quot; + $resource&#xD;&#xA;&#xD;&#xA;    $bytesToHash = [Text.Encoding]::UTF8.GetBytes($stringToHash)&#xD;&#xA;    $keyBytes = [Convert]::FromBase64String($sharedKey)&#xD;&#xA;&#xD;&#xA;    $sha256 = New-Object System.Security.Cryptography.HMACSHA256&#xD;&#xA;    $sha256.Key = $keyBytes&#xD;&#xA;    $calculatedHash = $sha256.ComputeHash($bytesToHash)&#xD;&#xA;    $encodedHash = [Convert]::ToBase64String($calculatedHash)&#xD;&#xA;    $authorization = 'SharedKey {0}:{1}' -f $customerId,$encodedHash&#xD;&#xA;    return $authorization&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;Function Post-OMSData($customerId, $sharedKey, $body, $logType)&#xD;&#xA;{&#xD;&#xA;    $method = &quot;POST&quot;&#xD;&#xA;    $contentType = &quot;application/json&quot;&#xD;&#xA;    $resource = &quot;/api/logs&quot;&#xD;&#xA;    $rfc1123date = [DateTime]::UtcNow.ToString(&quot;r&quot;)&#xD;&#xA;    $contentLength = $body.Length&#xD;&#xA;    $signature = Build-Signature `&#xD;&#xA;        -customerId $customerId `&#xD;&#xA;        -sharedKey $sharedKey `&#xD;&#xA;        -date $rfc1123date `&#xD;&#xA;        -contentLength $contentLength `&#xD;&#xA;        -fileName $fileName `&#xD;&#xA;        -method $method `&#xD;&#xA;        -contentType $contentType `&#xD;&#xA;        -resource $resource&#xD;&#xA;    $uri = &quot;https://&quot; + $customerId + &quot;.ods.opinsights.azure.com&quot; + $resource + &quot;?api-version=2016-04-01&quot;&#xD;&#xA;&#xD;&#xA;    $headers = @{&#xD;&#xA;        &quot;Authorization&quot; = $signature;&#xD;&#xA;        &quot;Log-Type&quot; = $logType;&#xD;&#xA;        &quot;x-ms-date&quot; = $rfc1123date;&#xD;&#xA;        &quot;time-generated-field&quot; = $TimeStampField;&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;&#x9;#$response = Invoke-WebRequest -Uri $uri -Method $method -ContentType $contentType -Headers $headers -Body $body -UseBasicParsing&#xD;&#xA;    #BOB &gt;&gt;&#xD;&#xA;&#x9;try {&#xD;&#xA;&#x9;&#x9;$response = Invoke-WebRequest -Uri $uri -Method $method -ContentType $contentType -Headers $headers -Body $body -UseBasicParsing&#xD;&#xA;        Write-EventLog -LogName Application -EventId 0 -Source &quot;UNIFY MIM Event Broker&quot; -EntryType Information -Message (&quot;Post-OMSData,Succeeded in posting data to $uri.&quot; + &quot;`n$json&quot;)&#xD;&#xA;&#x9;} catch {&#xD;&#xA;        Write-EventLog -LogName Application -EventId 0 -Source &quot;UNIFY MIM Event Broker&quot; -EntryType Error -Message (&quot;Post-OMSData,Failed to post data to $uri. &quot; + $_.Exception.Message + &quot;`n$json&quot;)&#xD;&#xA;&#x9;}&#xD;&#xA;    #BOB &lt;&lt;&#xD;&#xA;    return $response.StatusCode&#xD;&#xA;&#x9;&#xD;&#xA;}&#xD;&#xA;" logScript="$customerId = '1be3b063-d1ec-4250-8f21-a685257dee37';&#xD;&#xA;$sharedKey = 'ST/BZ4klwuDSkNJK5A54xu86kYTECfxpYCMrbS12ffU9C6NyAN9hjUkLYDr5WNeHVKAdXHEIq8eBJYzanZSSCQ==';&#xD;&#xA;&#xD;&#xA;$logType = 'EventBroker';&#xD;&#xA;$TimeStampField = 'Timestamp';&#xD;&#xA;&#xD;&#xA;$json = ConvertTo-Json $logEntry -Compress;&#xD;&#xA;Post-OMSData -customerId $customerId -sharedKey $sharedKey -body ([System.Text.Encoding]::UTF8.GetBytes($json)) -logType $logType&#xD;&#xA;" />
      <logFilter name="MinimumLoggingLevel" loggingLevel="Diagnostic" />
    </LogWriter>
    <logFilter name="MinimumSeverityLevel" severity="Error" />
  </LogWriter>
  <ScheduledLogTasks />
</LoggingEngine>